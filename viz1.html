<!DOCTYPE html>
<meta charset="utf-8">
<style> /* set the CSS */
</style>
<body>

<!-- load the d3.js library -->
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-axis.v1.min.js"></script>
<script>

    // set the dimensions and margins of the graph
    var margin = {top: 20, right: 20, bottom: 50, left: 70};
    var width = 0, height = 0;
    var svg = d3.select("body").append("svg");

    // set the ranges
    var x = 0;
    var y = 0;

    var squareSize = 20;

    var rect = null;

   /* var color = d3.scale.quantize()
        .range(["rgb(234,244,255)", "rgb(222,235,247)", "rgb(198,219,239)",
            "rgb(158,202,225)", "rgb(107,174,214)", "rgb(66,146,198)",
            "rgb(33,113,181)", "rgb(8,81,156)", "rgb(8,48,107)"])

    color.domain(1,5);*/

    // Get the data
    d3.csv("data.csv", function(error, data) {
        if (error) throw error;

        noms_questions = [];

        for (lab in data[0]){
            if (lab[1] > 0 && lab[1]<10){
                noms_questions.push(lab);
            }
        }

        width = 20 * data.length;
        height = 20 * noms_questions.length;
        svg.attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        x = d3.scaleLinear().range([0, squareSize*data.length]);
        y = d3.scaleBand().rangeRound([0, squareSize*noms_questions.length]);

        y.domain(noms_questions);

        tab_croise = [];

        console.log(noms_questions);

        for (item in noms_questions){
            for (var i = 0; i< data.length; i++) {
                    tab_croise.push({index_question : item, user_id : i});
            }
        }
        // Scale the range of the data
        console.log(data);
        // Add the x Axis
        svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .call(d3.axisTop(x).tickValues([]));

        // text label for the x axis
        svg.append("text")
            .attr("transform",
                "translate(" + (width/2) + " ," +
                ( margin.top - 5) + ")")
            .style("text-anchor", "middle")
            .text("Individus");

        // Add the y Axis
        svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .call(d3.axisLeft(y));

        // text label for the y axis
        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 0)
            .attr("x",0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("Questions");

        //render heatmap rects
        rect = svg.selectAll('rect')
            .data(tab_croise)
            .enter().append('rect')
            .attr('width',squareSize-1)
            .attr('height',squareSize-1)
            .attr('x',function(d){
                //console.log(d.user_id);
                return squareSize*(d.user_id) + margin.left+2;
            })
            .attr('y',function(d){
                return squareSize*d.index_question+ margin.top+2;
            })
            .attr('fill',function(d){
                var resp = data[d.user_id][noms_questions[d.index_question]];
                if (resp == 1) {
                    return 'rgb(234,244,255)';
                }
                else
                {
                    return 'rgb(8,81,156)';
                }
            });
    });

</script>
</body>
